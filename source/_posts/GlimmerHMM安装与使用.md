---
title: GlimmerHMM的安装与使用
date: 2017-05-26 11:30:01
categories: 基因组学

toc: true
---

# 介绍
GlimmerHMM 是一款基于GHMM（Generalized Hidden Markov Model）的基因预测工具，其中整合了GeneSplicer中分析剪切位点的方法。
与其他基因预测方法类似，需要首先进行training。
# 安装和基本用法
## 安装与配置
本工具提供了两种使用方法，既可以采用他们直接编译好的程序运行，也可以自己编译，直接再source中make即可。难度较低。
[官网下载链接](ftp://ccb.jhu.edu/pub/software/glimmerhmm/GlimmerHMM-3.0.4.tar.gz)
如果在运行中遇到了GLIBC的版本问题，重新在source中和train中进行make编译即可。

## 基本用法
在bin目录下，有三个程序：
* glimmerhmm_linux    32位的程序
* glimmerhmm_linux_x86_64    64位的程序
* glimmhmm.pl    提供了一个简单的perl script，提高易用性

而在train中，则主要是与training 相关的，重要的程序是：
* trainGlimmerHMM

# 使用
## training 过程
虽然相似物种的结果往往不差，但是为了提高预测的准确性，最好是采用本物种的数据进行training。
对于训练集的要求，与其他程序类似，自然是越准确越好，最好是收集实验证实的基因。
如果不可行的话，可以通过将预测的长的ORF（500bp以上）的蛋白与nr数据库比较，来获取同源蛋白。
### training 的相关命令
```
trainGlimmerHMM <mfasta_file> <exon_file> [optional_parameters]
```
两个主要的输入文件，都是fasta 格式
<mfasta_file>    是包含训练集基因的序列
<exon_file>    是<mfasta_file>中外显子的位置，格式如下，同一个序列上的不同基因，采用一个空行进行分割：
```
seq1 5 15
seq1 20 34
 
seq1 50 48
seq1 45 36
 
seq2 17 20
```
显而易见，seq1上有两个基因，一个正链，一个负链。
训练集中最少要包括50个基因，如果不够的话，则会报错退出。
### training 中的调参
一些阈值的改变可能会进一步提高预测的精度。
默认情况下，该程序会不断尝试在不同阈值下的假阳性和假阴性率，将在假阳性率的幅度变化小于1%时的阈值，作为最终使用的阈值。
当然，用户也可以自己设定假阳性和假阴性率，从而更加灵活的确定阈值。
最重要的是isochores 的设定，如果没有分区的话，则在config.file中仅有一行：
> C+G <= 100 train_0_100.cfg

isochores的意思是，目的序列中的基因可以分为两个区间，比如一个是0-40%，一个是40-100%d GC含量。两个区间的参数可以分别设置。

在运行training 之后，得到的参数文件夹中，对于acceptor site、donor site 、ATG等等都有测试阈值的结果文件。
想要调整这些阈值，可以在不同的false.*** 文件中比较在不同阈值下的假阳性和假阴性的水平，择优进行选择。
### 实践
在笔者的实践中，发现默认采用的阈值选择方法，其假阳性率还是很高的。
比如在acceptor 的数据中（false.acc ）：
```
 Threshold     False negatives     False positives
-11.704275         0 (  0.00% )        20278 ( 56.36% )
-11.618576         1 (  0.04% )        20195 ( 56.13% )
 -9.756974         2 (  0.09% )        18140 ( 50.42% )
 -9.098565         3 (  0.13% )        17418 ( 48.41% )
 -8.441363         4 (  0.18% )        16573 ( 46.06% )
 -8.241980         5 (  0.22% )        16298 ( 45.30% )
 -8.121769         6 (  0.26% )        16132 ( 44.84% )
 -7.312788         7 (  0.31% )        14935 ( 41.51% )
 -6.644487         8 (  0.35% )        13960 ( 38.80% )
 -6.363057         9 (  0.40% )        13564 ( 37.70% )
 -6.324996        10 (  0.44% )        13493 ( 37.50% )
 -6.116153        11 (  0.48% )        13138 ( 36.52% )
 -6.006301        12 (  0.53% )        12981 ( 36.08% )
 -5.802363        13 (  0.57% )        12696 ( 35.29% )
 -5.404492        14 (  0.62% )        12089 ( 33.60% )
 -5.074301        15 (  0.66% )        11606 ( 32.26% )
 -5.070013        16 (  0.70% )        11598 ( 32.24% )
```
第一个和第二个阈值造成的假阳性相差仅有0.23%，但是如果继续调高阈值的话，假阳性迅速减少了6%。
所以需要根据该结果酌情调整
笔者测试的设定是，当最后一次出现假阳性减少1%之后的那个阈值，这个值可以用一行perl script 搞定：
```
perl -ne 'next if(/Threshold/);my @arr=split /\s+/;$size=$data-$arr[8];$data=$arr[8];if($size>1){print;}' false.atg
```
这样确定后，在train_0_100.cfg中修改对应的阈值（笔者在此仅采用了一个isoshore，所以仅设置这个就可以）
这样，参数的设置就完成了。（阈值更改的效果见后面的讨论）
## 预测过程
该程序的预测特别快，比以快著称的snap 还要快很多。
### 相关命令
对其中的一些参数进行解释：
> -o file_name     Print output in file_name; if n>1 for top best predictions, output is in file_name.1, file_name.2, ... , file_name.n f
> -n n             Print top n best predictions

因为同一条序列可以有不同的预测方案，因此可以输出多个预测方案的结果。
默认情况下，与其他预测工具一样，给出唯一的结果。此参数意义不大，可以用于测试不同方案的结果，对比一下。

### 实践
glimmerhmm_linux_x86_64 或者glimmerhmm_linux 仅仅可以对于单个DNA 序列运行，即使输入的是一个multifasta文件，也仅仅会分析第一条序列。
而提供的glimmhmm.pl，对于参数的支持很差，并不能读入参数。

在此基础上，笔者对于该script 进行了修改，形成了[glimmhmm_modify.pl](/upload/glimmhmm_modify.pl)
主要增加了对于multi-fasta 和多参数的支持，由于时间关系，写的并不完善，如果遇到bug，请阅读代码修改或者与我联系。

# 总结
笔者以一种真菌为对象，利用该工具进行了基因的预测，结果发现，其表现与SNAP相当或略差，其优势是运行速度快，但也只剩下快了。
存在的问题是，无法利用各种hints 辅助预测，对于基因和基因的判断不够准确，经常错误的将基因连接或者分开。

从结果的对比来看，修改阈值后的结果其错误率明显高于默认值。
因此，**在没有把握的情况下，请不要大幅度改动阈值**。如果改动的话，一定要对比结果的差异。


